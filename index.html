<!DOCTYPE html>
<html>
    <head>
	<!-- Compiled and minified CSS -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
	<link rel="stylesheet" href="./main.css">
	<link href="https://fonts.googleapis.com/css2?family=MuseoModerno&display=swap" rel="stylesheet">

	<!--Let browser know website is optimized for mobile-->
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    </head>

    <body>
	<div class="container">
	    <div class="row">
		<div class="valign-wrapper col s6">
		    <!-- Switch -->
		    <div id="switch" class="switch">
			<label>ポジティブ
			    <input type="checkbox">
			    <span class="lever"></span>
			</label>
		    </div>
		</div>

		<div class="input-field col s6">
		    <select id="annual">
			<option value="0">一年次</option>
			<option value="1">二年次</option>
			<option value="2">三年次</option>
		    </select>
		    <label>年次</label>
		</div>
	    </div>

	    <div id="app">
		<div class="row time-and-date">
		    <div id="date" class="col s3">
			<p>{{ date }}</p>
		    </div>
		    <div id="time" class="col s3">
			<p>{{ time }}</p>
		    </div>
		</div>
		<div class="row">
		    <!-- Page Content goes here -->
		    <div v-for="item in graphs" class="col s2">
			<label for="">{{ item.label }}</label>
			<div class="z-depth-2 graph-region" v-bind:style="{ 'padding-top': (256 * (1.0 - item.val * 0.01)) + 'px'}">
			    <span class="center-align bar-graph blue lighten-1">{{ item.val.toFixed(2) }}%</span>
			</div>
		    </div>
		</div>
		<div class="row">
		    <div class="col s12">
			<label for="">天の声</label>
			<p class="z-depth-2">{{ advice }}</p>
			<button v-on:click="updateAdvice" class="waves-effect waves-light col btn s2 offset-s10">もう一声</button>
		    </div>
		</div>
		<div class="row">
		    <div>
			<input type="range" id="volume" name="volume" min="0" max="11">
			<label for="volume">Time</label>
		    </div>
		</div>
	    </div>	
	</div>
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.8.28/dayjs.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
	<script>
	 M.AutoInit ();

	 let annual = 0;

	 document.addEventListener('DOMContentLoaded', function() {
	     let annualElem = document.querySelector('#annual');
	     let options = {
		 classes: '',
		 dropdownOptions: {}
	     };
	     let instance = M.FormSelect.init(annualElem, options);

	     annualElem.addEventListener('change', function() {
		 annual = parseInt(this.value);
	     });

	     /* switch */
	     switchElem = document.querySelector('#switch');
	     switchElem.addEventListener('change', function() {
	     });
	 });

	 let app = new Vue({
	     el: '#app',
	     data: {
		 advice: 'ワンポイントアドバイス',
		 date: ' ',
		 time: ' ',
		 graphs: [
		     { label: '今日', val: 0 },
		     { label: '今週', val: 0 },
		     { label: '今月', val: 0 },
		     { label: '半期', val: 0 },
		     { label: '今年度', val: 0 },
		     { label: 'プロクラ', val: 0 }
		 ]
	     },
	     methods: {
		 updateAdvice: function(event) {
		     this.advice = "";
		 }
	     }
	 });

	 window.setInterval (
	     function () {
		 let now = dayjs();
		 app.date = now.format('YYYY/MM/DD');
		 app.time = now.format('HH:mm:ss');

		 // 今日のグラフ
		 app.graphs[0].val = 100 * (Math.min(now, dayjs().hour(17).minute(30)) - dayjs().hour(9).minute(30)) / (dayjs().hour(17).minute(30) - dayjs().hour(9).minute(30));
		 // 今週のグラフ
		 app.graphs[1].val = 100 * (now - dayjs().startOf('w')) / (dayjs().endOf('w').subtract(2, 'day') - dayjs().startOf('w'));
		 // 今月のグラフ
		 app.graphs[2].val = 100 * (now - dayjs().startOf('M')) / (dayjs().endOf('M') - dayjs().startOf('M'));
		 // 半期のグラフ
		 if (now.isBefore('2020-9-30')) {
		     app.graphs[3].val = 100 * (now - dayjs('2020-04-13')) / (dayjs('2020-09-30') - dayjs('2020-04-13'));
		 }
		 else {
		     app.graphs[3].val = 100 * (now - dayjs('2020-10-01')) / (dayjs('2021-03-20') - dayjs('2020-10-01'));
		 }
		 // 今年度のグラフ
		 app.graphs[4].val = 100 * (now - dayjs('2020-04-13')) / (dayjs('2021-03-20') - dayjs('2020-04-03'));
		 // プロクラのグラフ
		 app.graphs[5].val = 100 * (now - dayjs('2020-04-01').subtract(annual, 'y')) / (dayjs('2021-03-31') - dayjs('2020-04-01').subtract(annual, 'y'));
	     },
	     1000
	 );
	</script>
    </body>
</html>
